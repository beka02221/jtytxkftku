<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü–æ–∫—É–ø–∫–∞ –∑–∞ 30 Stars</title>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h3>–ö—É–ø–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç–æ–≤–∞—Ä –∑–∞ 30 Telegram¬†Stars</h3>
  <!-- –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã -->
  <button id="payButton">üí≥ –û–ø–ª–∞—Ç–∏—Ç—å 30¬†‚≠êÔ∏è</button>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Web App
    Telegram.WebApp.ready();
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã –≤ —Ü–≤–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è Telegram
    document.body.style.backgroundColor = Telegram.WebApp.themeParams.bg_color ?? "#FFFFFF";

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–û–ø–ª–∞—Ç–∏—Ç—å"
    document.getElementById('payButton').addEventListener('click', async () => {
      try {
        // 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏-–∏–Ω–≤–æ–π—Å–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–±–æ—Ç–∞)
        const response = await fetch('/create-invoice?item=product1');  
        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –±–æ—Ç–∞ –ø–æ —ç—Ç–æ–º—É URL –≤–µ—Ä–Ω—ë—Ç JSON –≤–∏–¥–∞ { "invoiceLink": "https://t.me/YourBot?start=invoice-XXX" }
        const data = await response.json();
        const invoiceUrl = data.invoiceLink;
        
        // 2. –í—ã–∑–æ–≤ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã Telegram Stars
        Telegram.WebApp.openInvoice(invoiceUrl, (status) => {
          if (status === 'paid') {
            // –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
            console.log('–û–ø–ª–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
            alert('–°–ø–∞—Å–∏–±–æ, –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞. –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω.');
          } else if (status === 'cancelled') {
            console.log('–û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.');
          } else if (status === 'failed') {
            console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–ø–ª–∞—Ç—ã.');
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
          }
          // status 'pending' –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Telegram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏–¥—ë—Ç –±–æ—Ç—É)
        });
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á–µ—Ç–∞:', e);
      }
    });
  </script>
</body>
</html>

